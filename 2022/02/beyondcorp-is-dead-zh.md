[BeyondCorp已死；BeyondCorp永生](https://mayakaczorowski.com/blogs/beyondcorp-is-dead)

随着美国政府最近[关于零信任网络安全原则的备忘录](https://www.whitehouse.gov/wp-content/uploads/2022/01/M-22-09.pdf)，组织对采用零信任架构重新产生了兴趣（和投资）。 BeyondCorp，谷歌最初的实现，它催生了对零信任的总体追求，仍然是许多组织的指导之星。似乎美国政府备忘录的作者，就像安全行业的其他人一样，阅读了 [BeyondCorp 的白皮书](https://cloud.google.com/beyondcorp)——并在很大程度上基于 BeyondCorp 的战略。

然而，实际上，没有任何组织成功实施完全零信任架构，许多零信任的支持者——包括美国政府——都错过了一个关键组成部分：设备。让我们忽略备忘录中关于 DNSSEC 和 STARTTLS 的建议，只关注零信任架构。

## 什么是零信任架构？

传统的网络架构依赖于网络边界来区分受信任和不受信任的用户，例如防火墙内的受信任员工与防火墙外部可能不受信任的各方。通过迁移到零信任架构，个人的位置，特别是他们所在的网络，不再只是决定个人是否受信任的唯一因素，而是使用其他上下文来确定他们是否可以访问给定的应用程序。不再有特权的、物理的、企业网络这样的东西。

（现在大多数关于零信任的讨论通常是指用户访问企业的内部服务、应用程序或机器；而不是一个服务连接到另一个服务。这是不幸的，因为服务到服务的通信是非常相关的——即使你验证和允许个人访问低风险应用程序，但该应用程序可以调用高风险应用程序，您没有有效保护您的高风险应用程序。如果您只是保护前门，但[杀手已经在房子里面](https://xkcd.com/742/)......好吧，你不会有一个美好的一天。）

我们可以根据网络分段来考虑每个应用程序的访问控制。每个应用程序都在自己的细分市场（微细分）中，而不是越来越受信任的应用程序的广泛同心圆。并不是说 VPN 本身不好，而是任何能够访问大量应用程序（而不仅仅是特定应用程序）的入口点或网关都是不好的。

BeyondCorp 于 2014 年在[一篇论文](https://cloud.google.com/beyondcorp)中首次介绍，是 Google 最初的具体实现，从中出现了零信任架构的更广泛的通用原则（和分析师类别）。

在 BeyondCorp 中，其理念是应用程序可直接从公共 Web 获得，而不是在受信任的网络内，并且访问应用程序的每个请求都是基于用户、设备和应用程序的策略决策。这些特征中的每一个都可以在一个范围内：

    用户信任：使用用户身份（SSO 令牌）和用户数据库（身份提供者）确定。可能会要求用户证明他们是受信任的，例如要求他们登录或要求硬件第二因素。
    设备信任：使用设备清单、设备标识（证书）和设备测量来确定。设备可能不受信任，例如外国的酒店大堂计算机，或者可能更受信任，例如使用MDM，打补丁的Chromebook，在公司的设备注册表中，设备证书受 TPM 保护，也用于安全启动以验证设备的操作系统，从与公司总部相同的物理网络连接。
    应用程序策略：每个应用程序都可以定义具有不同细粒度访问要求的策略，包括对用户和设备信任的不同最低要求。如果在用户尝试访问应用程序时信任不足，则可以向用户发出质询以进一步进行身份验证。

对于如何管理对内部应用程序的访问，这是一个极其复杂的模型。 BeyondCorp 是我们在设计零信任架构时应该追求的黄金标准——包括美国政府现在强制要求的目标。

存在一个问题：完全零信任架构的部署极其困难且极其昂贵，而且可以说，没有人实现过它。

## 甚至 Google 的 BeyondCorp 也不是完全零信任的架构

谷歌在几年的时间里逐渐采用了 BeyondCorp 的零信任架构，针对绿地和棕地应用程序。今天，BeyondCorp 并没有在谷歌 100% 推出。它永远不会。企业应用程序或引入的新工具总是存在差距，需要进行集成工作。

像任何系统一样，也有例外——这些例外变得越来越昂贵（因此不值得）解决。引用 [BeyondCorp 的另一篇论文](https://research.google/pubs/pub47356/)：

    尽管尽了最大努力来定义、推出、衡量和实施控制，您可能不可避免地面临一个严酷的现实，即 100% 统一控制部署是一个神话般的状态，独角兽在不关心恶意软件和国家资助的攻击者的情况下嬉戏。

多年来，谷歌已经投入了大量资源来开发 BeyondCorp：

    完全实现本文中概述的目标（以及 BeyondCorp 的更一般目标）需要大量资源。

如果它是谷歌规模的“重要资源”，那一定是一笔巨额投资。我敢说，如果 VP 知道实际需要的初始成本和时间，他们可能不会进行这项投资。（这可能超过人事管理办公室预留的 [990 万美元](https://tmf.cio.gov/projects/#zero-trust-networking)。）对于谷歌来说，有一个明确的投资理由。但对于许多其他组织来说，没有。

我不想给人留下谷歌实施 BeyondCorp 不成功的印象。确实如此——这个项目极大地改变了 Google 的运营方式并提高了其安全性。它引入了一种如何思考行业网络安全的新模型——零信任架构——并催生了多个分析师类别以及许多初创公司。这是每家大型科技公司安全团队的一项多年计划。美国政府的备忘录除了名字外，在所有方面都引用了它。

因此，尽管它很受欢迎，但如果谷歌没有完全成功，谷歌以外的公司也没有完全成功也就不足为奇了。

## 如果您说您正在实施零信任架构，安全团队会发笑

与来自顶级科技公司的其他开创性研究一样，当 BeyondCorp 论文发表时，初创公司的创建目标是复制这种零信任架构，让任何人都可以使用它。他们试图提供，我引用，“BeyondCorp……为云原生组织”，“谷歌之外的BeyondCorp”和“我们其他人的BeyondCorp”等等。他们收购了 Beyondcorp.com。他们创建了一个联盟。 BeyondCorp 的第一篇论文（有很多）于 2014 年发布——但现在是 2022 年，所以你不应该也有一个零信任架构吗？

发生了什么？初创公司将通过失败或被收购和吸收而启动。今天，您可以使用 OpenSSH ProxyCommand 配置来使用 Okta 验证您的 SSH 会话，并且您可以根据 IP 地址和是否启用屏幕锁定来限制从设备对应用程序的访问。这更好，但不幸的是，没有说太多。

现实情况是，如果您今天对安全专业人员说您“零信任”，他们会认为您很天真，并且还没有意识到您实际上在为自己注册什么。他们试图使用市场上已有的工具来接近零信任架构，并面临太多挑战。他们看到市场变得兴奋，公司诞生和消亡，但并没有真正改变。如果在特拉华州注册的多家公司已经因试图实现这一目标而死去，为什么总部设在弗吉尼亚州的公司会成功？这可能是安全专业人员现实而不是过度悲观（正如他们经常被描绘的那样）的罕见情况。

不是让你更沮丧，而是更糟。今天市场上的工具甚至还没有完成零信任的艰难部分。
每个人似乎都错过了有关设备的信息

回想一下，Google 的 BeyondCorp 包含三个部分：用户、设备和应用程序策略。但是——你可能已经注意到——其中最重要的部分，从长远来看，是设备。应使用设备清单、设备身份（如证书）和设备测量来确定设备信任。

那么，美国政府的备忘录在其仅一页半的设备上说了什么？您应该清点您的资产，并在政府范围内进行端点检测和响应。 MFA 上的文章比设备的整个主题还要多！ （并不是说 MFA 不重要。）

为什么设备如此重要？如果您还记得，如果用户没有足够的信任来访问特定的应用程序，Google 的 BeyondCorp 可以要求用户执行挑战，例如重新验证或使用硬件第二因素。但是什么是完全不切实际的？要求用户更改他们使用的设备！ （即使是我最喜欢的 Google 员工，家里也有 5 台笔记本电脑，但只有其中一些可以工作，用于工作的更少，而且大部分都在另一个房间里。）所以，当你决定授权一个特定的访问请求时，你有一些关于用户的数据，但理想情况下，你有尽可能多的关于设备的数据，因为你不能再得到了。您可以推断出给定连接的信任级别的大部分信息来自设备，而不是用户。

您和美国政府应该如何衡量设备信任度？总结得不好：拥有您的车队的库存，使用 MDM 来测量操作系统版本、补丁级别和加密状态，是的——备忘录得到了这一部分。 （顺便问一下，你最近有没有试过买一个覆盖三个以上操作系统的 MDM？）

而且，使用特定于每个设备的设备证书，受机器的可信平台模块 (TPM) 保护。为此，您只需要对 TPM 有足够的了解即可实现安全启动以验证设备的操作系统以及受保护的设备证书（对不起，NSA，我认为您在 Java 中的实现不会受到 log4j 的影响, 会做), 以及为这些证书运行企业 CA 的能力, 当您的员工需要访问任何应用程序时都可以使用。您已经为您的 SSH 证书运行了其中之一，对吧？
这让我们何去何从？

所以，美国政府的某个人也阅读了 BeyondCorp 的论文，也想要一个真正的、有效的、零信任的架构。我们都不要。而且我怀疑政府强制要求（到 2024 年！）不会成为现实——没有一家科技公司可以像今天这样自上而下的强制要求，我没有理由相信美国政府能做到更好的。

这些是正确的目标。作为一个行业，我们可以继续构建理想的零信任解决方案。解决方案包括：

    用户身份验证，基于单点登录和硬件第二因素；
    设备身份验证，基于设备注册表、硬件绑定设备身份和测量的设备特性（如安全启动）；
    应用程序策略，使每个应用程序都被微分段并执行自己的策略，没有单点故障；
    网络没有公共入口点；
    采用世界级密码学的端到端加密；
    …并满足所有传统企业要求，例如审计日志记录或 SAML 集成。

我认为今天没有人能够构建该解决方案的每个部分。对于像美国政府这样的组织来说，仅仅在 3 年内就做好了，实在是太过分了。我们仍然会在它们存在的地方将组件拼凑在一起。

美国政府的备忘录感觉不像是零信任的命令，而是在我们所有的营销中插入“零信任”的命令。希望我们也能从中找到一些缺失的部分。

